<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Administración de Causas - Sistema Mejorado</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
:root {
  /* Paleta de colores moderna */
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --primary-light: #8b5cf6;
  --secondary: #64748b;
  --accent: #f59e0b;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #06b6d4;
  
  /* Gradientes */
  --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  --gradient-danger: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  
  /* Colores de fondo */
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --bg-tertiary: #f1f5f9;
  --bg-dark: #1e293b;
  
  /* Colores de texto */
  --text-primary: #1e293b;
  --text-secondary: #64748b;
  --text-muted: #94a3b8;
  --text-inverse: #ffffff;
  
  /* Sombras y efectos */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
  --shadow-glow: 0 0 50px rgba(102, 102, 255, 0.3);
  
  /* Transiciones */
  --transition-fast: 0.2s ease-out;
  --transition-normal: 0.3s ease-out;
  --transition-slow: 0.5s ease-out;
  
  /* Bordes */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.5rem;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
  background: var(--gradient-primary);
  min-height: 100vh;
  color: var(--text-primary);
  line-height: 1.6;
  overflow-x: hidden;
}

/* Animaciones de entrada */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes expandCard {
  from {
    max-height: 0;
    opacity: 0;
  }
  to {
    max-height: 500px;
    opacity: 1;
  }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

@keyframes shimmer {
  0% { background-position: -200px 0; }
  100% { background-position: calc(200px + 100%) 0; }
}

.fade-in-up {
  animation: fadeInUp 0.8s ease-out;
}

.slide-in-right {
  animation: slideInRight 0.6s ease-out;
}

/* Contenedor principal */
.app-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Header */
.app-header {
  text-align: center;
  margin-bottom: 3rem;
  animation: fadeInUp 1s ease-out;
}

.app-title {
  font-size: 3rem;
  font-weight: 700;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 0.5rem;
  text-shadow: 0 4px 20px rgba(102, 102, 255, 0.3);
}

.app-subtitle {
  font-size: 1.2rem;
  color: var(--text-secondary);
  font-weight: 400;
}

/* Dashboard de estadísticas */
.dashboard {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-bottom: 3rem;
}

.stat-card {
  background: var(--bg-primary);
  padding: 2rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
  transition: all var(--transition-normal);
  animation: fadeInUp 0.8s ease-out;
  cursor: pointer;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-xl);
}

.stat-card.clickable:hover {
  cursor: pointer;
  background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--gradient-primary);
}

.stat-card.success::before {
  background: var(--gradient-success);
}

.stat-card.warning::before {
  background: var(--gradient-danger);
}

.stat-card.info::before {
  background: linear-gradient(135deg, #667eea, #764ba2);
}

.stat-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  background: var(--gradient-primary);
}

.stat-card.success .stat-icon {
  background: var(--gradient-success);
}

.stat-card.warning .stat-icon {
  background: var(--gradient-danger);
}

.stat-card.info .stat-icon {
  background: linear-gradient(135deg, #667eea, #764ba2);
}

.stat-value {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.stat-label {
  font-size: 0.9rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-weight: 500;
}

.stat-change {
  font-size: 0.8rem;
  font-weight: 600;
  margin-top: 0.5rem;
}

.stat-change.positive {
  color: var(--success);
}

.stat-change.negative {
  color: var(--danger);
}

/* Expansión de tarjetas */
.stat-card-expanded {
  margin-top: 1rem;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: var(--radius-md);
  border: 1px solid rgba(99, 102, 241, 0.1);
  animation: expandCard 0.3s ease-out;
  overflow: hidden;
}

.expandable-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
  opacity: 0;
}

.expandable-content.expanded {
  max-height: 500px;
  opacity: 1;
}

.vencimiento-item {
  padding: 0.75rem;
  margin: 0.5rem 0;
  background: white;
  border-radius: var(--radius-sm);
  border-left: 4px solid var(--primary);
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-fast);
}

.vencimiento-item:hover {
  transform: translateX(5px);
  box-shadow: var(--shadow-md);
}

.vencimiento-fecha {
  font-weight: 600;
  color: var(--primary);
  font-size: 0.9rem;
}

.vencimiento-expediente {
  font-weight: 700;
  color: var(--text-primary);
  margin: 0.25rem 0;
}

.vencimiento-detalle {
  color: var(--text-secondary);
  font-size: 0.85rem;
  line-height: 1.4;
}

/* Secciones de estadísticas detalladas */
.estadisticas-detalladas {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  padding: 2rem;
  margin: 2rem 0;
  box-shadow: var(--shadow-md);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.estadistica-categoria {
  margin-bottom: 2rem;
  border: 1px solid var(--bg-tertiary);
  border-radius: var(--radius-md);
  overflow: hidden;
  transition: all var(--transition-normal);
}

.estadistica-categoria:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
}

.categoria-header {
  background: var(--bg-tertiary);
  padding: 1rem 1.5rem;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all var(--transition-fast);
}

.categoria-header:hover {
  background: var(--primary);
  color: white;
}

.categoria-header i {
  transition: transform var(--transition-fast);
}

.categoria-header.active i {
  transform: rotate(180deg);
}

.categoria-title {
  font-weight: 600;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.categoria-count {
  background: var(--primary);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 50px;
  font-size: 0.8rem;
  font-weight: 600;
}

.categoria-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out;
}

.categoria-content.expanded {
  max-height: 1000px;
}

.categoria-lista {
  padding: 1rem 1.5rem;
}

.expediente-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  margin: 0.5rem 0;
  background: var(--bg-secondary);
  border-radius: var(--radius-sm);
  border: 1px solid transparent;
  transition: all var(--transition-fast);
}

.expediente-item:hover {
  border-color: var(--primary);
  transform: translateX(5px);
  box-shadow: var(--shadow-sm);
}

.expediente-info {
  flex: 1;
}

.expediente-numero {
  font-weight: 700;
  color: var(--primary);
}

.expediente-caratula {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-top: 0.25rem;
}

.expediente-meta {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.meta-badge {
  padding: 0.25rem 0.5rem;
  border-radius: var(--radius-sm);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.meta-badge.estado {
  background: var(--bg-primary);
  color: var(--primary);
  border: 1px solid var(--primary);
}

.meta-badge.prioridad {
  background: var(--warning);
  color: white;
}

/* Gráficos */
.charts-section {
  margin-bottom: 3rem;
}

.charts-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 2rem;
  margin-top: 2rem;
}

.chart-container {
  background: var(--bg-primary);
  padding: 2rem;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.chart-container h3 {
  font-size: 1.3rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  text-align: center;
}

.chart-wrapper {
  position: relative;
  height: 400px;
}

/* Login Form */
.login-section {
  max-width: 450px;
  margin: 3rem auto;
  background: var(--bg-primary);
  padding: 3rem;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  border: 1px solid rgba(255, 255, 255, 0.2);
  animation: fadeInUp 1s ease-out;
}

.login-title {
  font-size: 1.8rem;
  font-weight: 600;
  text-align: center;
  margin-bottom: 2rem;
  color: var(--text-primary);
}

.form-group {
  margin-bottom: 1.5rem;
}

.form-input {
  width: 100%;
  padding: 1rem;
  border: 2px solid #e2e8f0;
  border-radius: var(--radius-md);
  font-size: 1rem;
  font-family: inherit;
  background: var(--bg-primary);
  color: var(--text-primary);
  transition: all var(--transition-fast);
  outline: none;
}

.form-input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  transform: translateY(-1px);
}

.form-input::placeholder {
  color: var(--text-muted);
}

/* Botones modernos */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 2rem;
  border: none;
  border-radius: var(--radius-md);
  font-size: 1rem;
  font-weight: 600;
  font-family: inherit;
  text-decoration: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  outline: none;
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: var(--gradient-primary);
  color: var(--text-inverse);
  box-shadow: var(--shadow-md);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-success {
  background: var(--gradient-success);
  color: var(--text-inverse);
}

.btn-warning {
  background: var(--gradient-danger);
  color: var(--text-inverse);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--secondary), #94a3b8);
  color: var(--text-inverse);
}

.btn-print {
  background: linear-gradient(135deg, #8b5cf6, #6366f1);
  color: white;
  box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
}

.btn-print:hover {
  background: linear-gradient(135deg, #7c3aed, #4f46e5);
  box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
  transform: translateY(-2px);
}

/* Botones de impresión específicos */
.print-controls {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin: 2rem 0;
  padding: 2rem;
  background: rgba(139, 92, 246, 0.05);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(139, 92, 246, 0.1);
}

/* Controles principales */
.main-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
  margin: 3rem 0;
  padding: 2rem;
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(10px);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.control-btn {
  min-width: 160px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

/* Formulario principal */
.main-form {
  background: var(--bg-primary);
  padding: 3rem;
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-lg);
  margin: 3rem 0;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.form-title {
  font-size: 1.8rem;
  font-weight: 600;
  text-align: center;
  margin-bottom: 2rem;
  color: var(--text-primary);
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
  margin-top: 2rem;
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-label {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--text-primary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.form-textarea {
  min-height: 120px;
  resize: vertical;
}

.form-select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.5rem center;
  background-repeat: no-repeat;
  background-size: 1.5em 1.5em;
  padding-right: 2.5rem;
}

/* Tabla moderna */
.table-container {
  background: var(--bg-primary);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  margin: 2rem 0;
}

.modern-table {
  width: 100%;
  border-collapse: collapse;
}

.modern-table th,
.modern-table td {
  padding: 1.5rem 1rem;
  text-align: left;
  border-bottom: 1px solid #e2e8f0;
}

.modern-table th {
  background: var(--bg-tertiary);
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.modern-table tr:hover {
  background: var(--bg-secondary);
}

/* Mensajes */
.message {
  padding: 1.5rem;
  border-radius: var(--radius-md);
  margin: 1rem 0;
  text-align: center;
  font-weight: 500;
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.message-info {
  background: rgba(6, 182, 212, 0.1);
  color: var(--info);
  border-color: var(--info);
}

/* Estados especiales */
.priority-high {
  color: var(--danger);
  font-weight: 700;
}

.priority-medium {
  color: var(--warning);
  font-weight: 600;
}

.priority-low {
  color: var(--success);
  font-weight: 500;
}

/* Usuario info */
.user-info {
  background: var(--gradient-primary);
  color: var(--text-inverse);
  padding: 1.5rem;
  border-radius: var(--radius-md);
  text-align: center;
  margin: 1rem 0;
  font-weight: 500;
  box-shadow: var(--shadow-md);
}

/* Chatbot */
.chatbot-toggle {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--gradient-primary);
  color: var(--text-inverse);
  border: none;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  transition: all var(--transition-fast);
  animation: float 3s ease-in-out infinite;
}

.chatbot-toggle:hover {
  transform: scale(1.1);
  box-shadow: var(--shadow-glow);
}

.chatbot-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  width: 380px;
  height: 500px;
  background: var(--bg-primary);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  z-index: 1000;
  display: none;
  flex-direction: column;
  overflow: hidden;
  backdrop-filter: blur(20px);
}

.chat-header {
  background: var(--gradient-primary);
  color: var(--text-inverse);
  padding: 1.5rem;
  font-weight: 600;
  text-align: center;
}

.chat-body {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.chat-input-area {
  padding: 1rem;
  border-top: 1px solid #e2e8f0;
  display: flex;
  gap: 0.5rem;
}

.message-bubble {
  padding: 1rem;
  border-radius: var(--radius-md);
  max-width: 80%;
  word-wrap: break-word;
  animation: slideInRight 0.3s ease-out;
}

.user-message {
  background: var(--gradient-primary);
  color: var(--text-inverse);
  margin-left: auto;
}

.bot-message {
  background: var(--bg-secondary);
  color: var(--text-primary);
  margin-right: auto;
}

/* Badges y elementos dinámicos */
.badge {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.badge.primary {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
}

.badge.success {
  background: rgba(16, 185, 129, 0.1);
  color: var(--success);
}

.badge.warning {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning);
}

.badge.secondary {
  background: rgba(107, 114, 128, 0.1);
  color: var(--secondary);
}

.priority-alta {
  color: var(--danger);
  font-weight: 700;
}

.priority-media {
  color: var(--warning);
  font-weight: 600;
}

.priority-baja {
  color: var(--success);
  font-weight: 500;
}

.priority-ninguna {
  color: var(--text-muted);
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.75rem;
  margin: 0 0.25rem;
}

/* Responsive */
@media (max-width: 768px) {
  .app-container {
    padding: 1rem;
    margin: 1rem;
  }
  
  .app-title {
    font-size: 2rem;
  }
  
  .dashboard {
    grid-template-columns: 1fr;
  }
  
  .charts-grid {
    grid-template-columns: 1fr;
  }
  
  .main-controls, .print-controls {
    flex-direction: column;
  }
  
  .control-btn {
    width: 100%;
    min-width: auto;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .chatbot-container {
    width: calc(100vw - 2rem);
    height: calc(100vh - 4rem);
    right: 1rem;
    bottom: 1rem;
  }
}

/* Estados ocultos */
.hidden {
  display: none !important;
}

.visible {
  display: block;
}

/* Efectos adicionales */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.char-counter {
  font-size: 0.8rem;
  color: var(--text-muted);
  text-align: right;
  margin-top: 0.5rem;
}

.multiselect-info {
  font-size: 0.8rem;
  color: var(--primary);
  margin-top: 0.5rem;
}

.required {
  color: var(--danger);
  font-weight: bold;
  margin-left: 0.25rem;
}

/* Estilos para impresión */
 {
  .chatbot-toggle,
  .chatbot-container,
  .main-controls,
  .print-controls {
    display: none !important;
  }
  
  .app-container {
    box-shadow: none;
    border: none;
    margin: 0;
    padding: 1rem;
  }
  
  body {
    background: white !important;
  }
  
  .stat-card, .chart-container, .estadisticas-detalladas {
    break-inside: avoid;
  }
}

/* Mejoras visuales */
.shimmer-loading {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200px 100%;
  animation: shimmer 1.5s infinite;
}

.glass-effect {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.pulse-animation {
  animation: pulse 2s infinite;
}

.expandable-indicator {
  transition: transform 0.3s ease;
}

.expandable-indicator.expanded {
  transform: rotate(180deg);
}

</style>
</head>
<body>

<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <h1 class="app-title">
      <i class="fas fa-gavel"></i>
      Administración de Causas
    </h1>
    <p class="app-subtitle">Defensoría Civil y Comercial 6 - Poder Judicial Misiones</p>
  </header>

  <!-- Dashboard de Estadísticas -->
  <section class="dashboard hidden" id="dashboard-section">
    <div class="stat-card clickable" data-category="proceso">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="fas fa-folder-open"></i>
        </div>
      </div>
      <div class="stat-value" id="total-causas">0</div>
      <div class="stat-label">Total de Causas</div>
      <div class="stat-change positive" id="causas-change">+12% este mes</div>
    </div>

    <div class="stat-card success clickable" data-category="intervencion">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
      </div>
      <div class="stat-value" id="causas-finalizadas">0</div>
      <div class="stat-label">Por Intervención</div>
      <div class="stat-change positive" id="finalizadas-change">Ver detalles</div>
    </div>

    <div class="stat-card warning clickable expandable" data-category="vencimientos">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        <i class="fas fa-chevron-down expandable-indicator"></i>
      </div>
      <div class="stat-value" id="causas-vencimiento">0</div>
      <div class="stat-label">Próximos Vencimientos</div>
      <div class="stat-change negative" id="vencimiento-change">Hacer clic para detalles</div>
      
      <div class="expandable-content" id="vencimientos-content">
        <div class="stat-card-expanded">
          <h4 style="margin-bottom: 1rem; color: var(--primary);">
            <i class="fas fa-calendar-alt"></i> Próximos Vencimientos
          </h4>
          <div id="vencimientos-lista">
            <!-- Se llenará dinámicamente -->
          </div>
        </div>
      </div>
    </div>

    <div class="stat-card info clickable" data-category="recursos">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="fas fa-balance-scale"></i>
        </div>
      </div>
      <div class="stat-value" id="causas-recursos">0</div>
      <div class="stat-label">Con Recursos</div>
      <div class="stat-change positive" id="recursos-change">Ver recursos</div>
    </div>

    <div class="stat-card clickable" data-category="usuario">
      <div class="stat-header">
        <div class="stat-icon">
          <i class="fas fa-user-friends"></i>
        </div>
      </div>
      <div class="stat-value" id="causas-usuario">0</div>
      <div class="stat-label">Por Usuario</div>
      <div class="stat-change positive" id="usuario-change">Ver asignaciones</div>
    </div>
  </section>

  <!-- Estadísticas Detalladas -->
  <section class="estadisticas-detalladas hidden" id="estadisticas-detalladas">
    <h2 style="text-align: center; margin-bottom: 2rem; color: var(--primary);">
      <i class="fas fa-chart-bar"></i> Estadísticas Detalladas
    </h2>

    <!-- Controles de impresión -->
    <div class="print-controls">
      <button class="btn btn-print" onclick="imprimirRegistroNuevo()">
        <i class="fas fa-plus"></i> Imprimir Registro Nuevo
      </button>
      <button class="btn btn-print" onclick="imprimirListado()">
        <i class="fas fa-list"></i> Imprimir Listado
      </button>
      <button class="btn btn-print" onclick="imprimirEstadisticas()">
        <i class="fas fa-chart-bar"></i> Imprimir Estadísticas
      </button>
    </div>

    <div class="estadistica-categoria" id="categoria-proceso">
      <div class="categoria-header" onclick="toggleCategoria('proceso')">
        <div class="categoria-title">
          <i class="fas fa-folder-open"></i>
          <span>Por Tipo de Proceso</span>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
          <span class="categoria-count" id="count-proceso">0</span>
          <i class="fas fa-chevron-down expandable-indicator"></i>
        </div>
      </div>
      <div class="categoria-content" id="content-proceso">
        <div class="categoria-lista" id="lista-proceso">
          <!-- Se llenará dinámicamente -->
        </div>
      </div>
    </div>

    <div class="estadistica-categoria" id="categoria-intervencion">
      <div class="categoria-header" onclick="toggleCategoria('intervencion')">
        <div class="categoria-title">
          <i class="fas fa-hands-helping"></i>
          <span>Por Tipo de Intervención</span>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
          <span class="categoria-count" id="count-intervencion">0</span>
          <i class="fas fa-chevron-down expandable-indicator"></i>
        </div>
      </div>
      <div class="categoria-content" id="content-intervencion">
        <div class="categoria-lista" id="lista-intervencion">
          <!-- Se llenará dinámicamente -->
        </div>
      </div>
    </div>

    <div class="estadistica-categoria" id="categoria-recursos">
      <div class="categoria-header" onclick="toggleCategoria('recursos')">
        <div class="categoria-title">
          <i class="fas fa-balance-scale"></i>
          <span>Con Recursos Interpuestos</span>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
          <span class="categoria-count" id="count-recursos">0</span>
          <i class="fas fa-chevron-down expandable-indicator"></i>
        </div>
      </div>
      <div class="categoria-content" id="content-recursos">
        <div class="categoria-lista" id="lista-recursos">
          <!-- Se llenará dinámicamente -->
        </div>
      </div>
    </div>

    <div class="estadistica-categoria" id="categoria-usuario">
      <div class="categoria-header" onclick="toggleCategoria('usuario')">
        <div class="categoria-title">
          <i class="fas fa-user-friends"></i>
          <span>Por Usuario Asignado</span>
        </div>
        <div style="display: flex; align-items: center; gap: 1rem;">
          <span class="categoria-count" id="count-usuario">0</span>
          <i class="fas fa-chevron-down expandable-indicator"></i>
        </div>
      </div>
      <div class="categoria-content" id="content-usuario">
        <div class="categoria-lista" id="lista-usuario">
          <!-- Se llenará dinámicamente -->
        </div>
      </div>
    </div>
  </section>

  <!-- Gráficos -->
  <section class="charts-section hidden" id="charts-section">
    <div class="charts-grid">
      <div class="chart-container">
        <h3><i class="fas fa-chart-line"></i> Evolución Mensual de Causas</h3>
        <div class="chart-wrapper">
          <canvas id="causasChart" style="height: 400px;"></canvas>
        </div>
      </div>
      
      <div class="chart-container">
        <h3><i class="fas fa-chart-pie"></i> Distribución por Tipo</h3>
        <div class="chart-wrapper">
          <canvas id="tiposChart" style="height: 400px;"></canvas>
        </div>
      </div>
    </div>
  </section>

  <!-- Formulario de Login -->
  <section class="login-section" id="login-section">
    <h2 class="login-title">
      <i class="fas fa-user-lock"></i>
      Acceso al Sistema
    </h2>
    
    <div class="form-group">
      <input type="text" id="nombre" class="form-input login-field" placeholder="Nombre" autocomplete="given-name" />
    </div>
    
    <div class="form-group">
      <input type="text" id="apellido" class="form-input login-field" placeholder="Apellido" autocomplete="family-name" />
    </div>
    
    <div class="form-group">
      <input type="email" id="email" class="form-input login-field" placeholder="Correo Electrónico" autocomplete="username" />
    </div>
    
    <div class="form-group">
      <input type="password" id="password" class="form-input login-field" placeholder="Contraseña (6 caracteres)" 
             title="Únicamente seis caracteres alfanuméricos" pattern="[a-zA-Z0-9]{6}" maxlength="6" autocomplete="current-password" />
    </div>
    
    <div class="form-group">
      <select id="rol" class="form-input form-select">
        <option value="">Seleccionar rol (solo para registro)</option>
        <option value="Defensor">Defensor</option>
        <option value="Secretario">Secretario</option>
        <option value="Empleado">Empleado</option>
      </select>
    </div>
    
    <div class="form-group">
      <button class="btn btn-primary" id="btnLogin" style="width: 100%; margin-bottom: 1rem;">
        <i class="fas fa-sign-in-alt"></i>
        Iniciar Sesión
      </button>
      <button class="btn btn-secondary" id="btnRegister" style="width: 100%;">
        <i class="fas fa-user-plus"></i>
        Registrarse
      </button>
    </div>
  </section>

  <!-- Mensaje informativo -->
  <div id="mensaje" class="message message-info">
    <i class="fas fa-info-circle"></i>
    Inicie sesión para acceder al sistema de administración de causas.
  </div>

  <!-- Aplicación principal -->
  <main id="main-app-container" class="hidden">
    
    <div id="userInfo" class="user-info">
      <i class="fas fa-user"></i>
      <span id="user-details"></span>
    </div>

    <!-- Controles principales -->
    <section class="main-controls">
      <button class="btn btn-primary control-btn" id="btnVerListado">
        <i class="fas fa-list"></i>
        Ver Listado
      </button>
      
      <button class="btn btn-success control-btn" id="btnNuevoRegistro">
        <i class="fas fa-plus"></i>
        Nuevo Registro
      </button>
      
      <a href="https://defensoria6.github.io/datospartes/" target="_blank" class="btn btn-secondary control-btn">
        <i class="fas fa-users"></i>
        Datos de Partes
      </a>
      
      <button class="btn btn-primary control-btn" id="btnBuscar">
        <i class="fas fa-search"></i>
        Buscar
      </button>
      
      <button class="btn btn-success control-btn" id="btnImprimir">
        <i class="fas fa-print"></i>
        Imprimir
      </button>
      
      <button class="btn btn-primary control-btn" id="btnEstadistica">
        <i class="fas fa-chart-bar"></i>
        Estadísticas
      </button>
      
      <button class="btn btn-warning control-btn" id="btnLogout">
        <i class="fas fa-sign-out-alt"></i>
        Cerrar Sesión
      </button>
    </section>

    <!-- Buscador -->
    <div class="form-group" style="max-width: 400px; margin: 2rem auto;">
      <input type="text" id="buscadorInput" class="form-input hidden" placeholder="Buscar en el listado..." />
    </div>

    <!-- Contenedor de tabla -->
    <div id="tablaCausas" class="table-container hidden"></div>

    <!-- Formulario principal -->
    <section class="main-form hidden" id="form-section">
      <h2 class="form-title" id="tituloForm">
        <i class="fas fa-folder-plus"></i>
        Nuevo Expediente
      </h2>
      
      <form id="formCausa">
        <div class="form-grid">
          
          <div class="form-field">
            <label class="form-label" for="numCausa">
              N° Expediente <span class="required">*</span>
            </label>
            <input id="numCausa" name="numCausa" class="form-input" required autocomplete="off" />
          </div>
          
          <div class="form-field">
            <label class="form-label" for="caratula">
              Carátula Completa <span class="required">*</span>
            </label>
            <textarea id="caratula" name="caratula" class="form-input form-textarea" required></textarea>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="tipoProceso">
              Tipo de Proceso <span class="required">*</span>
            </label>
            <select id="tipoProceso" name="tipoProceso" class="form-input form-select" required>
              <option value="Administrativo">Administrativo</option>              
              <option value="Civil">Civil</option>
              <option value="Penal">Penal</option>
              <option value="Laboral">Laboral</option>
              <option value="Familia">Familia</option>
              <option value="Violencia Familiar">Violencia Familiar</option>
              <option value="Paz">Juzgado de Paz</option>              
            </select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="juzgado">
              Juzgado <span class="required">*</span>
            </label>
            <select id="juzgado" name="juzgado" class="form-input form-select" required></select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="fechaInicio">Fecha de Inicio</label>
            <input type="date" id="fechaInicio" name="fechaInicio" class="form-input" />
          </div>
          
          <div class="form-field">
            <label class="form-label" for="fechaPase">Fecha de Pase</label>
            <input type="datetime-local" id="fechaPase" name="fechaPase" class="form-input" />
          </div>
          
          <div class="form-field">
            <label class="form-label" for="intervencion">Intervención</label>
            <select id="intervencion" name="intervencion" class="form-input form-select">
              <option>Ministerio Complementario</option>
              <option>Ministerio Principal</option>
              <option>Patrocinante Actor</option>
              <option>Patrocinante Demandado</option>
              <option>Patrocinante Tercero</option>
              <option value="Defensor de Ausente">Defensor de Ausente</option>
              <option value="Defensor Oficial Asesor Letrado">Defensor Oficial Asesor Letrado</option>
            </select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="audiencias">Audiencias Señaladas</label>
            <input type="datetime-local" id="audiencias" name="audiencias" class="form-input" />
          </div>
          
          <div class="form-field">
            <label class="form-label" for="vencimiento">Vencimiento</label>
            <input type="datetime-local" id="vencimiento" name="vencimiento" class="form-input" />
          </div>
          
          <div class="form-field">
            <label class="form-label" for="usuarioAsignado">Usuario Asignado</label>
            <select id="usuarioAsignado" name="usuarioAsignado" class="form-input form-select"></select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="prioridad">Prioridad de Trabajo</label>
            <select id="prioridad" name="prioridad" class="form-input form-select">
              <option>Alta</option>
              <option>Media</option>
              <option>Baja</option>
              <option>Ninguna</option>
            </select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="estado">Estado</label>
            <select id="estado" name="estado" class="form-input form-select">
              <option>Finalizado</option>
              <option>En trámite</option>
              <option>Archivado</option>
              <option>En Alzada</option>              
            </select>
          </div>
          
          <div class="form-field">
            <label class="form-label" for="recursos">Recursos Interpuestos</label>
            <select id="recursos" name="recursos" class="form-input form-select">
              <option value="">Seleccione un recurso</option>
              <option value="Apelación">Apelación</option>
              <option value="Queja">Queja</option>              
              <option value="Inconstitucionalidad">Inconstitucionalidad</option>
              <option value="Nulidad">Nulidad</option>
              <option value="Reposición">Reposición</option>
              <option value="Aclaratoria">Aclaratoria</option>
              <option value="Recurso Extraordinario">Recurso Extraordinario</option>
              <option value="Recurso de Hecho">Recurso de Hecho</option>
              <option value="Recurso de Inaplicabilidad">Recurso de Inaplicabilidad</option>
            </select>
          </div>

          <div class="form-field">
            <label class="form-label" for="radicadoAlzada">Radicado en Alzada</label>
            <select id="radicadoAlzada" name="radicadoAlzada" class="form-input form-select">
              <option value="">No aplica</option>
              <option>Cámara de Apelaciones en lo Civil, Comercial,de Familia y Fiscal Tributaria- Sala I- Posadas</option>
              <option>Cámara de Apelaciones en lo Civil, Comercial,de Familia y Fiscal Tributaria- Sala II- Posadas</option>
              <option>Cámara de Apelaciones en lo Civil, Comercial,de Familia y Fiscal Tributaria- Sala III- Posadas</option>
              <option>Cámara de Apelaciones en lo Civil, Comercial,de Familia y Fiscal Tributaria- Sala IV- Posadas</option>
              <option>Cámara de Apelaciones en lo Civil, Comercial,de Familia y Fiscal Tributaria- Sala V- Posadas</option>
              <option>Cámara de Apelaciones en lo Laboral-Sala I- Posadas</option>
              <option>Cámara de Apelaciones en lo Laboral-Sala II- Posadas</option>
              <option>Cámara de Apelaciones en lo Penal y de Menores-Sal I- Posadas</option>
              <option>Cámara de Apelaciones en lo Penal y de Menores-Sal II- Posadas</option>
              <option>Superior Tribunal de Justicia</option>
              <option>Superior Tribunal de Justicia -Secretaria Judicial</option>
            </select>
          </div>

          <div class="form-field">
            <label class="form-label" for="proteccionPersona">
              Medidas de Protección de Persona (Selección múltiple)
            </label>
            <select id="proteccionPersona" name="proteccionPersona" class="form-input" multiple size="4">
              <option value="Medidas Autosatisfactivas">Medidas Autosatisfactivas</option>
              <option value="Prohibición de Acercamiento">Prohibición de Acercamiento</option>
              <option value="Restricción Perimetral">Restricción Perimetral</option>
              <option value="Asistencia Económica">Asistencia Económica</option>
              <option value="Tenencia Precautoria">Tenencia Precautoria</option>
              <option value="Régimen de Visitas">Régimen de Visitas</option>
              <option value="Alimentos Provisionales">Alimentos Provisionales</option>
              <option value="Asistencia Psicológica">Asistencia Psicológica</option>
              <option value="Asistencia Médica">Asistencia Médica</option>
              <option value="Protección Patrimonial">Protección Patrimonial</option>
              <option value="Curatela">Curatela</option>
              <option value="Tutela">Tutela</option>
              <option value="Guarda">Guarda</option>
            </select>
            <div id="proteccionPersona-selected" class="multiselect-info"></div>
          </div>

          <div class="form-field">
            <label class="form-label" for="organismos">
              Organismos Intervinientes (Selección múltiple)
            </label>
            <select id="organismos" name="organismos" class="form-input" multiple size="4">
              <option value="Ministerio de Desarrollo Social">Ministerio de Desarrollo Social</option>
              <option value="Ministerio de Salud Misiones">Ministerio de Salud Misiones</option>
              <option value="Secretaría de Niñez, Adolescencia y Familia">Secretaría de Niñez, Adolescencia y Familia</option>
              <option value="Centro provincial de prevención y asistencia integral para el control de las adicciones">Centro provincial de prevención y asistencia integral para el control de las adicciones</option>
              <option value="Hospital Escuela de Salud Mental">Hospital Escuela de Salud Mental</option>
              <option value="Centro de Atención Primaria de la Salud (CAPS)">Centro de Atención Primaria de la Salud (CAPS)</option>
              <option value="Defensoría de Niñas, Niños y Adolescentes">Defensoría de Niñas, Niños y Adolescentes</option>
              <option value="Programa Provincial de Asistencia Integral">Programa Provincial de Asistencia Integral</option>
              <option value="Servicio Local de Protección de Derechos">Servicio Local de Protección de Derechos</option>
              <option value="Secretaria de Adulto Mayor">Secretaria de Adulto Mayor</option>
              <option value="ANSeS">ANSeS</option>
              <option value="PAMI">PAMI</option>
              <option value="Programa ProHuerta">Programa ProHuerta</option>
              <option value="IPRODHA Vivienda">IPRODHA Vivienda</option>
              <option value="Municipalidad de Posadas">Municipalidad de Posadas</option>
            </select>
            <div id="organismos-selected" class="multiselect-info"></div>
          </div>

          <div class="form-field" style="grid-column: 1/-1">
            <label class="form-label" for="observaciones">
              Observaciones (máx. 1000 palabras)
            </label>
            <textarea id="observaciones" name="observaciones" class="form-input form-textarea"></textarea>
            <div class="char-counter" id="counter">0/1000</div>
          </div>

        </div>
        
        <div class="main-controls" style="margin-top: 3rem;">
          <button class="btn btn-success control-btn" type="button" id="btnGuardar">
            <i class="fas fa-save"></i>
            Guardar
          </button>
          <button class="btn btn-secondary control-btn" type="reset" id="btnCancelar">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- Chatbot -->
  <button class="chatbot-toggle" id="chatbot-toggle">
    <i class="fas fa-robot"></i>
  </button>
  
  <div class="chatbot-container" id="chatbot-container">
    <div class="chat-header">
      <i class="fas fa-robot"></i>
      Asistente Inteligente
    </div>
    <div class="chat-body" id="chat-body"></div>
    <div class="chat-input-area">
      <input type="text" id="chat-input" class="form-input" placeholder="Pregunta sobre las causas..." style="margin: 0;" />
      <button class="btn btn-primary" id="chat-send">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// Configuración Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBDXZYAxWsvMiMGCrPRp3EBVuU0dzuWF4M",
  authDomain: "sistemadefensoria6.firebaseapp.com",
  projectId: "sistemadefensoria6"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Variables globales
let currentUser = null;
let causasData = [];
let editingCausa = null;
let chartInstances = {};

// Referencias DOM
const elements = {
  // Login
  email: document.getElementById("email"),
  password: document.getElementById("password"),
  nombre: document.getElementById("nombre"),
  apellido: document.getElementById("apellido"),
  rol: document.getElementById("rol"),
  btnLogin: document.getElementById("btnLogin"),
  btnRegister: document.getElementById("btnRegister"),
  
  // Secciones principales
  loginSection: document.getElementById("login-section"),
  mainAppContainer: document.getElementById("main-app-container"),
  dashboardSection: document.getElementById("dashboard-section"),
  chartsSection: document.getElementById("charts-section"),
  formSection: document.getElementById("form-section"),
  estadisticasDetalladas: document.getElementById("estadisticas-detalladas"),
  
  // Mensajes y UI
  mensaje: document.getElementById("mensaje"),
  userInfo: document.getElementById("userInfo"),
  userDetails: document.getElementById("user-details"),
  
  // Controles
  btnVerListado: document.getElementById("btnVerListado"),
  btnNuevoRegistro: document.getElementById("btnNuevoRegistro"),
  btnBuscar: document.getElementById("btnBuscar"),
  btnImprimir: document.getElementById("btnImprimir"),
  btnEstadistica: document.getElementById("btnEstadistica"),
  btnLogout: document.getElementById("btnLogout"),
  
  // Formulario
  formCausa: document.getElementById("formCausa"),
  tituloForm: document.getElementById("tituloForm"),
  btnGuardar: document.getElementById("btnGuardar"),
  btnCancelar: document.getElementById("btnCancelar"),
  
  // Tabla y búsqueda
  tablaCausas: document.getElementById("tablaCausas"),
  buscadorInput: document.getElementById("buscadorInput"),
  
  // Formulario campos
  numCausa: document.getElementById("numCausa"),
  caratula: document.getElementById("caratula"),
  tipoProceso: document.getElementById("tipoProceso"),
  juzgado: document.getElementById("juzgado"),
  usuarioAsignado: document.getElementById("usuarioAsignado"),
  observaciones: document.getElementById("observaciones"),
  counter: document.getElementById("counter"),
  
  // Estadísticas
  totalCausas: document.getElementById("total-causas"),
  causasFinalizadas: document.getElementById("causas-finalizadas"),
  causasVencimiento: document.getElementById("causas-vencimiento"),
  causasTramite: document.getElementById("causas-tramite"),
  causasRecursos: document.getElementById("causas-recursos"),
  causasUsuario: document.getElementById("causas-usuario"),
  
  // Vencimientos
  vencimientosContent: document.getElementById("vencimientos-content"),
  vencimientosLista: document.getElementById("vencimientos-lista"),
  
  // Chatbot
  chatbotToggle: document.getElementById("chatbot-toggle"),
  chatbotContainer: document.getElementById("chatbot-container"),
  chatBody: document.getElementById("chat-body"),
  chatInput: document.getElementById("chat-input"),
  chatSend: document.getElementById("chat-send")
};

// Juzgados por tipo de proceso
const juzgadosPorTipo = {
  Administrativo: [
    "CEJUME - Posadas",
    "DEUT Defensorias - Posadas",
    "Legajo Defensoria Civil y Comercial N° 6"
  ],
  Civil: [
    "Juzgado Civil y Comercial N° 1 - Posadas",
    "Juzgado Civil y Comercial N° 2 - Posadas",
    "Juzgado Civil y Comercial N° 3 - Posadas",
    "Juzgado Civil y Comercial N° 4 - Posadas",
    "Juzgado Civil y Comercial N° 5 - Posadas",
    "Juzgado Civil y Comercial N° 6 - Posadas",
    "Juzgado Civil y Comercial N° 7 - Posadas",
    "Juzgado Civil y Comercial N° 8 - Posadas",
    "Juzgado 1 Inst Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"
  ],
  Penal: [
    "Juzgado de Instrucción N° 1 - Posadas",
    "Juzgado de Instrucción N° 2 - Posadas",
    "Juzgado de Instrucción N° 3 - Posadas",
    "Juzgado de Instrucción N° 6 - Posadas",
    "Juzgado de Instrucción N° 7 - Posadas",
    "Tribunal Penal N° 1 - Posadas",
    "Tribunal Penal N° 2 - Posadas",
    "Juzgado Correccional y de Menores N° 1 - Posadas",
    "Juzgado Correccional y de Menores N° 2 - Posadas"
  ],
  Laboral: [
    "Juzgado Laboral N° 1 - Posadas",
    "Juzgado Laboral N° 2 - Posadas",
    "Juzgado Laboral N° 3 - Posadas",
    "Juzgado Laboral N° 4 - Posadas"
  ],
  Familia: [
    "Juzgado de Familia N° 1 - Posadas",
    "Juzgado de Familia N° 2 - Posadas",
    "Juzgado de Familia N° 3 - Posadas",
    "Juzgado de Familia y Violencia Familiar de Garupá",
    "Juzgado 1 Inst Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"
  ],
  "Violencia Familiar": [
    "Juzgado de Violencia Familiar N° 1 - Posadas",
    "Juzgado de Violencia Familiar N° 2 - Posadas",
    "Juzgado de Familia y Violencia Familiar de Garupá",
    "Juzgado 1 Inst Civil Comercial Laboral Familia y Violencia Fliar- Apostoles"
  ],
  "Paz": [
    "Juzgado de Paz Civil Comercial N° 1 - Posadas",
    "Juzgado de Paz Civil Comercial N° 2 - Posadas",
    "Juzgado de Paz Villa Cabello - Posadas",
    "Juzgado de Paz Itaembe Mini - Posadas",
    "Juzgado de Paz Itaembe Guazu- Posadas",
    "Juzgado de Paz - Garupá",
    "Juzgado de Paz - Garupá Fátima",
    "Juzgado de Paz - Profundidad",
    "Juzgado de Paz - Apóstoles"
  ]
};

// Datos de ejemplo para demostración
const datosEjemplo = [
  {
    id: '1',
    numCausa: 'EXP-2024-001',
    caratula: 'MARTINEZ, JUAN C/ LOPEZ, MARIA S/ DIVORCIO VINCULAR',
    tipoProceso: 'Familia',
    juzgado: 'Juzgado de Familia N° 1 - Posadas',
    fechaInicio: '2024-01-15',
    intervencion: 'Ministerio Principal',
    estado: 'En trámite',
    prioridad: 'Media',
    recursos: 'Apelación',
    usuarioAsignado: 'user1',
    vencimiento: '2024-12-30T10:00',
    observaciones: 'Causa en tramitación normal'
  },
  {
    id: '2',
    numCausa: 'EXP-2024-002',
    caratula: 'GARCIA, PEDRO C/ ESTADO PROVINCIAL S/ AMPARO',
    tipoProceso: 'Administrativo',
    juzgado: 'CEJUME - Posadas',
    fechaInicio: '2024-02-01',
    intervencion: 'Patrocinante Actor',
    estado: 'En Alzada',
    prioridad: 'Alta',
    recursos: 'Inconstitucionalidad',
    usuarioAsignado: 'user2',
    vencimiento: '2024-12-25T14:30',
    observaciones: 'Causa compleja con recursos pendientes'
  },
  {
    id: '3',
    numCausa: 'EXP-2024-003',
    caratula: 'RODRIGUEZ, ANA C/ EMPRESA XYZ S.A. S/ DESPIDO',
    tipoProceso: 'Laboral',
    juzgado: 'Juzgado Laboral N° 2 - Posadas',
    fechaInicio: '2024-03-10',
    intervencion: 'Patrocinante Actor',
    estado: 'Finalizado',
    prioridad: 'Baja',
    recursos: '',
    usuarioAsignado: 'user1',
    vencimiento: '',
    observaciones: 'Causa finalizada con acuerdo'
  }
];

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
  setupEventListeners();
  setupFormValidation();
  setupCharts();
  setupLoginEnterKey();
  setupStatCardsClickable();
});

// Configurar Enter en login
function setupLoginEnterKey() {
  const loginFields = document.querySelectorAll('.login-field');
  loginFields.forEach(field => {
    field.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        handleLogin();
      }
    });
  });
}

// Configurar tarjetas estadísticas clickeables
function setupStatCardsClickable() {
  const statCards = document.querySelectorAll('.stat-card[data-category]');
  statCards.forEach(card => {
    card.addEventListener('click', function() {
      const category = this.dataset.category;
      
      if (category === 'vencimientos') {
        toggleVencimientos();
      } else {
        showCategoriaDetalle(category);
      }
    });
  });
}

// Toggle vencimientos
function toggleVencimientos() {
  const content = elements.vencimientosContent;
  const indicator = document.querySelector('[data-category="vencimientos"] .expandable-indicator');
  
  if (content.classList.contains('expanded')) {
    content.classList.remove('expanded');
    indicator.classList.remove('expanded');
  } else {
    content.classList.add('expanded');
    indicator.classList.add('expanded');
    loadProximosVencimientos();
  }
}

// Cargar próximos vencimientos
function loadProximosVencimientos() {
  const now = new Date();
  const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
  
  const vencimientos = causasData.filter(c => {
    if (c.vencimiento) {
      const vencimiento = new Date(c.vencimiento);
      return vencimiento >= now && vencimiento <= nextWeek;
    }
    return false;
  });

  if (vencimientos.length === 0) {
    elements.vencimientosLista.innerHTML = '<div class="vencimiento-item">No hay vencimientos próximos</div>';
    return;
  }

  elements.vencimientosLista.innerHTML = vencimientos.map(causa => {
    const vencimiento = new Date(causa.vencimiento);
    const fecha = vencimiento.toLocaleDateString('es-AR');
    const hora = vencimiento.toLocaleTimeString('es-AR', {hour: '2-digit', minute: '2-digit'});
    
    return `
      <div class="vencimiento-item">
        <div class="vencimiento-fecha">${fecha} - ${hora}</div>
        <div class="vencimiento-expediente">${causa.numCausa}</div>
        <div class="vencimiento-detalle">${causa.caratula}</div>
      </div>
    `;
  }).join('');
}

// Mostrar categoría detalle
function showCategoriaDetalle(category) {
  elements.estadisticasDetalladas.classList.remove('hidden');
  updateEstadisticasDetalladas();
  
  // Scroll to the specific category
  const categoryElement = document.getElementById(`categoria-${category}`);
  if (categoryElement) {
    setTimeout(() => {
      categoryElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // Auto-expand the category
      toggleCategoria(category);
    }, 500);
  }
}

// Toggle categoría
function toggleCategoria(categoria) {
  const content = document.getElementById(`content-${categoria}`);
  const header = document.querySelector(`#categoria-${categoria} .categoria-header`);
  const indicator = header.querySelector('.expandable-indicator');
  
  if (content.classList.contains('expanded')) {
    content.classList.remove('expanded');
    header.classList.remove('active');
    indicator.classList.remove('expanded');
  } else {
    content.classList.add('expanded');
    header.classList.add('active');
    indicator.classList.add('expanded');
    loadCategoriaData(categoria);
  }
}

// Cargar datos de categoría
function loadCategoriaData(categoria) {
  const listaElement = document.getElementById(`lista-${categoria}`);
  
  switch(categoria) {
    case 'proceso':
      loadProcesoData(listaElement);
      break;
    case 'intervencion':
      loadIntervencionData(listaElement);
      break;
    case 'recursos':
      loadRecursosData(listaElement);
      break;
    case 'usuario':
      loadUsuarioData(listaElement);
      break;
  }
}

function loadProcesoData(container) {
  const procesoGroups = {};
  causasData.forEach(causa => {
    const tipo = causa.tipoProceso || 'Sin clasificar';
    if (!procesoGroups[tipo]) {
      procesoGroups[tipo] = [];
    }
    procesoGroups[tipo].push(causa);
  });

  container.innerHTML = Object.entries(procesoGroups).map(([tipo, causas]) => `
    <div style="margin-bottom: 2rem;">
      <h4 style="color: var(--primary); margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
        ${tipo} (${causas.length})
      </h4>
      ${causas.map(causa => createExpedienteItem(causa)).join('')}
    </div>
  `).join('');
}

function loadIntervencionData(container) {
  const intervencionGroups = {};
  causasData.forEach(causa => {
    const intervencion = causa.intervencion || 'Sin asignar';
    if (!intervencionGroups[intervencion]) {
      intervencionGroups[intervencion] = [];
    }
    intervencionGroups[intervencion].push(causa);
  });

  container.innerHTML = Object.entries(intervencionGroups).map(([intervencion, causas]) => `
    <div style="margin-bottom: 2rem;">
      <h4 style="color: var(--primary); margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
        ${intervencion} (${causas.length})
      </h4>
      ${causas.map(causa => createExpedienteItem(causa)).join('')}
    </div>
  `).join('');
}

function loadRecursosData(container) {
  const conRecursos = causasData.filter(causa => causa.recursos && causa.recursos.trim() !== '');
  
  if (conRecursos.length === 0) {
    container.innerHTML = '<div class="expediente-item">No hay expedientes con recursos interpuestos</div>';
    return;
  }

  const recursosGroups = {};
  conRecursos.forEach(causa => {
    const recurso = causa.recursos;
    if (!recursosGroups[recurso]) {
      recursosGroups[recurso] = [];
    }
    recursosGroups[recurso].push(causa);
  });

  container.innerHTML = Object.entries(recursosGroups).map(([recurso, causas]) => `
    <div style="margin-bottom: 2rem;">
      <h4 style="color: var(--primary); margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
        ${recurso} (${causas.length})
      </h4>
      ${causas.map(causa => createExpedienteItem(causa)).join('')}
    </div>
  `).join('');
}

function loadUsuarioData(container) {
  const usuarioGroups = {};
  causasData.forEach(causa => {
    const usuario = causa.usuarioAsignado || 'Sin asignar';
    if (!usuarioGroups[usuario]) {
      usuarioGroups[usuario] = [];
    }
    usuarioGroups[usuario].push(causa);
  });

  container.innerHTML = Object.entries(usuarioGroups).map(([usuario, causas]) => `
    <div style="margin-bottom: 2rem;">
      <h4 style="color: var(--primary); margin-bottom: 1rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
        ${usuario} (${causas.length})
      </h4>
      ${causas.map(causa => createExpedienteItem(causa)).join('')}
    </div>
  `).join('');
}

function createExpedienteItem(causa) {
  return `
    <div class="expediente-item">
      <div class="expediente-info">
        <div class="expediente-numero">${causa.numCausa}</div>
        <div class="expediente-caratula">${(causa.caratula || 'Sin carátula').substring(0, 80)}${(causa.caratula || '').length > 80 ? '...' : ''}</div>
      </div>
      <div class="expediente-meta">
        <span class="meta-badge estado">${causa.estado || 'N/A'}</span>
        <span class="meta-badge prioridad">${causa.prioridad || 'N/A'}</span>
      </div>
    </div>
  `;
}

// Funciones de impresión
function imprimirRegistroNuevo() {
  // Crear ventana para registro nuevo
  const printWindow = window.open('', '_blank');
  const formHtml = generateFormPrintContent();
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Registro Nuevo - Expediente</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          .form-field { margin-bottom: 20px; }
          .form-label { font-weight: bold; margin-bottom: 5px; display: block; }
          .form-input { width: 100%; padding: 8px; border: 1px solid #ccc; }
          .header { text-align: center; margin-bottom: 30px; }
           { body { margin: 0; padding: 10px; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Nuevo Expediente</h1>
          <h2>Defensoría Civil y Comercial 6 - Poder Judicial Misiones</h2>
        </div>
        ${formHtml}
      </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.print();
}

function imprimirListado() {
  // Imprimir tabla actual
  const tableContent = elements.tablaCausas.innerHTML;
  const printWindow = window.open('', '_blank');
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Listado de Causas</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
          th { background-color: #f5f5f5; font-weight: bold; }
          .header { text-align: center; margin-bottom: 30px; }
           { body { margin: 0; padding: 10px; font-size: 12px; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Listado de Causas</h1>
          <h2>Defensoría Civil y Comercial 6 - Poder Judicial Misiones</h2>
          <p>Fecha: ${new Date().toLocaleDateString('es-AR')}</p>
          <p>Total de causas: ${causasData.length}</p>
        </div>
        ${tableContent}
      </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.print();
}

function imprimirEstadisticas() {
  // Generar reporte de estadísticas
  const printWindow = window.open('', '_blank');
  const estadisticasHtml = generateEstadisticasPrintContent();
  
  printWindow.document.write(`
    <html>
      <head>
        <title>Estadísticas del Sistema</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          .stat-item { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
          .stat-title { font-size: 18px; font-weight: bold; color: #333; margin-bottom: 10px; }
          .stat-value { font-size: 24px; font-weight: bold; color: #6366f1; }
          .header { text-align: center; margin-bottom: 30px; }
          .detail-section { margin: 30px 0; }
          .detail-title { font-size: 16px; font-weight: bold; margin: 20px 0 10px 0; }
          .detail-list { margin-left: 20px; }
           { body { margin: 0; padding: 10px; } }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Estadísticas del Sistema</h1>
          <h2>Defensoría Civil y Comercial 6 - Poder Judicial Misiones</h2>
          <p>Fecha de generación: ${new Date().toLocaleDateString('es-AR')} - ${new Date().toLocaleTimeString('es-AR')}</p>
        </div>
        ${estadisticasHtml}
      </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.print();
}

function generateFormPrintContent() {
  return `
    <form>
      <div class="form-field">
        <label class="form-label">N° Expediente *</label>
        <input class="form-input" type="text" placeholder="Ingrese número de expediente">
      </div>
      
      <div class="form-field">
        <label class="form-label">Carátula Completa *</label>
        <textarea class="form-input" rows="3" placeholder="Ingrese carátula completa"></textarea>
      </div>
      
      <div class="form-field">
        <label class="form-label">Tipo de Proceso *</label>
        <select class="form-input">
          <option>Administrativo</option>
          <option>Civil</option>
          <option>Penal</option>
          <option>Laboral</option>
          <option>Familia</option>
          <option>Violencia Familiar</option>
          <option>Paz</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">Juzgado *</label>
        <input class="form-input" type="text" placeholder="Seleccione juzgado">
      </div>
      
      <div class="form-field">
        <label class="form-label">Fecha de Inicio</label>
        <input class="form-input" type="date">
      </div>
      
      <div class="form-field">
        <label class="form-label">Intervención</label>
        <select class="form-input">
          <option>Ministerio Complementario</option>
          <option>Ministerio Principal</option>
          <option>Patrocinante Actor</option>
          <option>Patrocinante Demandado</option>
          <option>Patrocinante Tercero</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">Estado</label>
        <select class="form-input">
          <option>En trámite</option>
          <option>Finalizado</option>
          <option>Archivado</option>
          <option>En Alzada</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">Prioridad de Trabajo</label>
        <select class="form-input">
          <option>Alta</option>
          <option>Media</option>
          <option>Baja</option>
          <option>Ninguna</option>
        </select>
      </div>
      
      <div class="form-field">
        <label class="form-label">Observaciones</label>
        <textarea class="form-input" rows="4" placeholder="Ingrese observaciones"></textarea>
      </div>
    </form>
  `;
}

function generateEstadisticasPrintContent() {
  const total = causasData.length;
  const finalizadas = causasData.filter(c => c.estado === 'Finalizado').length;
  const enTramite = causasData.filter(c => c.estado === 'En trámite').length;
  const conRecursos = causasData.filter(c => c.recursos && c.recursos.trim() !== '').length;

  // Agrupar por tipo de proceso
  const tiposProceso = {};
  causasData.forEach(causa => {
    const tipo = causa.tipoProceso || 'Sin clasificar';
    tiposProceso[tipo] = (tiposProceso[tipo] || 0) + 1;
  });

  // Agrupar por prioridad
  const prioridades = {};
  causasData.forEach(causa => {
    const prioridad = causa.prioridad || 'Sin asignar';
    prioridades[prioridad] = (prioridades[prioridad] || 0) + 1;
  });

  return `
    <div class="stat-item">
      <div class="stat-title">Total de Causas</div>
      <div class="stat-value">${total}</div>
    </div>
    
    <div class="stat-item">
      <div class="stat-title">Causas Finalizadas</div>
      <div class="stat-value">${finalizadas}</div>
    </div>
    
    <div class="stat-item">
      <div class="stat-title">Causas en Trámite</div>
      <div class="stat-value">${enTramite}</div>
    </div>
    
    <div class="stat-item">
      <div class="stat-title">Causas con Recursos</div>
      <div class="stat-value">${conRecursos}</div>
    </div>
    
    <div class="detail-section">
      <div class="detail-title">Distribución por Tipo de Proceso:</div>
      <div class="detail-list">
        ${Object.entries(tiposProceso).map(([tipo, count]) => `
          <div>${tipo}: ${count} causas</div>
        `).join('')}
      </div>
    </div>
    
    <div class="detail-section">
      <div class="detail-title">Distribución por Prioridad:</div>
      <div class="detail-list">
        ${Object.entries(prioridades).map(([prioridad, count]) => `
          <div>${prioridad}: ${count} causas</div>
        `).join('')}
      </div>
    </div>
  `;
}

// Actualizar estadísticas detalladas
function updateEstadisticasDetalladas() {
  // Actualizar contadores
  const tiposCounts = {};
  causasData.forEach(causa => {
    const tipo = causa.tipoProceso || 'Sin clasificar';
    tiposCounts[tipo] = (tiposCounts[tipo] || 0) + 1;
  });
  document.getElementById('count-proceso').textContent = Object.keys(tiposCounts).length;

  const intervencionCounts = {};
  causasData.forEach(causa => {
    const intervencion = causa.intervencion || 'Sin asignar';
    intervencionCounts[intervencion] = (intervencionCounts[intervencion] || 0) + 1;
  });
  document.getElementById('count-intervencion').textContent = Object.keys(intervencionCounts).length;

  const conRecursos = causasData.filter(c => c.recursos && c.recursos.trim() !== '').length;
  document.getElementById('count-recursos').textContent = conRecursos;

  const usuarioCounts = {};
  causasData.forEach(causa => {
    const usuario = causa.usuarioAsignado || 'Sin asignar';
    usuarioCounts[usuario] = (usuarioCounts[usuario] || 0) + 1;
  });
  document.getElementById('count-usuario').textContent = Object.keys(usuarioCounts).length;
}

// Hacer toggleCategoria disponible globalmente
window.toggleCategoria = toggleCategoria;

// Inicializar aplicación
function initializeApp() {
  auth.onAuthStateChanged(user => {
    if (user) {
      loadUserData(user);
    } else {
      showLoginSection();
      // Cargar datos de ejemplo para demostración
      causasData = datosEjemplo;
      updateStatistics();
      updateEstadisticasDetalladas();
    }
  });
  
  // Cargar juzgados iniciales
  updateJuzgados();
}

// Event listeners
function setupEventListeners() {
  // Login
  elements.btnLogin.addEventListener('click', handleLogin);
  elements.btnRegister.addEventListener('click', handleRegister);
  elements.btnLogout.addEventListener('click', handleLogout);
  
  // Controles principales
  elements.btnVerListado.addEventListener('click', showListado);
  elements.btnNuevoRegistro.addEventListener('click', showNuevoRegistro);
  elements.btnBuscar.addEventListener('click', toggleBuscador);
  elements.btnImprimir.addEventListener('click', handleImprimir);
  elements.btnEstadistica.addEventListener('click', toggleEstadisticas);
  
  // Formulario
  elements.btnGuardar.addEventListener('click', handleGuardar);
  elements.btnCancelar.addEventListener('click', handleCancelar);
  elements.tipoProceso.addEventListener('change', updateJuzgados);
  
  // Chatbot
  elements.chatbotToggle.addEventListener('click', toggleChatbot);
  elements.chatSend.addEventListener('click', sendChatMessage);
  elements.chatInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') sendChatMessage();
  });
  
  // Búsqueda
  elements.buscadorInput.addEventListener('input', handleSearch);
  
  // Contador de caracteres
  elements.observaciones.addEventListener('input', updateCharCounter);
}

// Autenticación
async function handleLogin() {
  const email = elements.email.value.trim();
  const password = elements.password.value.trim();
  
  if (!email || !password) {
    showMessage('Por favor ingrese email y contraseña', 'error');
    return;
  }
  
  try {
    showLoading(elements.btnLogin);
    await auth.signInWithEmailAndPassword(email, password);
    showMessage('Inicio de sesión exitoso', 'success');
  } catch (error) {
    showMessage('Error en el inicio de sesión: ' + error.message, 'error');
  } finally {
    hideLoading(elements.btnLogin, 'Iniciar Sesión');
  }
}

async function handleRegister() {
  const email = elements.email.value.trim();
  const password = elements.password.value.trim();
  const nombre = elements.nombre.value.trim();
  const apellido = elements.apellido.value.trim();
  const rol = elements.rol.value;
  
  if (!email || !password || !nombre || !apellido || !rol) {
    showMessage('Por favor complete todos los campos para el registro', 'error');
    return;
  }
  
  try {
    showLoading(elements.btnRegister);
    const credential = await auth.createUserWithEmailAndPassword(email, password);
    
    await db.collection('usuarios').doc(credential.user.uid).set({
      nombre,
      apellido,
      email,
      rol,
      fechaRegistro: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    showMessage('Registro exitoso', 'success');
  } catch (error) {
    showMessage('Error en el registro: ' + error.message, 'error');
  } finally {
    hideLoading(elements.btnRegister, 'Registrarse');
  }
}

async function handleLogout() {
  try {
    await auth.signOut();
    showMessage('Sesión cerrada exitosamente', 'success');
    showLoginSection();
  } catch (error) {
    showMessage('Error al cerrar sesión', 'error');
  }
}

// Cargar datos del usuario
async function loadUserData(user) {
  try {
    const userDoc = await db.collection('usuarios').doc(user.uid).get();
    if (userDoc.exists) {
      currentUser = { uid: user.uid, ...userDoc.data() };
      showMainApp();
      loadCausas();
      updateUserInfo();
      loadUsuariosSelect();
    }
  } catch (error) {
    showMessage('Error al cargar datos del usuario', 'error');
  }
}

// Mostrar secciones
function showLoginSection() {
  elements.loginSection.classList.remove('hidden');
  elements.mainAppContainer.classList.add('hidden');
  elements.dashboardSection.classList.add('hidden');
  elements.chartsSection.classList.add('hidden');
  elements.formSection.classList.add('hidden');
  elements.estadisticasDetalladas.classList.add('hidden');
}

function showMainApp() {
  elements.loginSection.classList.add('hidden');
  elements.mainAppContainer.classList.remove('hidden');
  elements.dashboardSection.classList.remove('hidden');
  elements.chartsSection.classList.remove('hidden');
}

function showNuevoRegistro() {
  elements.formSection.classList.remove('hidden');
  elements.tablaCausas.classList.add('hidden');
  elements.estadisticasDetalladas.classList.add('hidden');
  elements.tituloForm.innerHTML = '<i class="fas fa-folder-plus"></i> Nuevo Expediente';
  elements.formCausa.reset();
  editingCausa = null;
  updateJuzgados();
}

function showListado() {
  elements.formSection.classList.add('hidden');
  elements.tablaCausas.classList.remove('hidden');
  elements.estadisticasDetalladas.classList.add('hidden');
  displayCausas();
}

function toggleBuscador() {
  elements.buscadorInput.classList.toggle('hidden');
  if (!elements.buscadorInput.classList.contains('hidden')) {
    elements.buscadorInput.focus();
  }
}

function toggleEstadisticas() {
  const isVisible = !elements.estadisticasDetalladas.classList.contains('hidden');
  
  if (isVisible) {
    elements.estadisticasDetalladas.classList.add('hidden');
  } else {
    elements.formSection.classList.add('hidden');
    elements.tablaCausas.classList.add('hidden');
    elements.estadisticasDetalladas.classList.remove('hidden');
    updateStatistics();
    updateCharts();
    updateEstadisticasDetalladas();
  }
}

// Cargar causas
async function loadCausas() {
  try {
    const snapshot = await db.collection('causas').orderBy('fechaCreacion', 'desc').get();
    causasData = snapshot.docs.map(doc => ({
      id: doc.id,
      ...doc.data()
    }));
    updateStatistics();
    updateEstadisticasDetalladas();
    displayCausas();
  } catch (error) {
    showMessage('Error al cargar causas', 'error');
  }
}

// Actualizar estadísticas
function updateStatistics() {
  const total = causasData.length;
  const finalizadas = causasData.filter(c => c.estado === 'Finalizado').length;
  const enTramite = causasData.filter(c => c.estado === 'En trámite').length;
  const conRecursos = causasData.filter(c => c.recursos && c.recursos.trim() !== '').length;
  
  // Próximos vencimientos (próximos 7 días)
  const now = new Date();
  const nextWeek = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
  const proximosVencimientos = causasData.filter(c => {
    if (c.vencimiento) {
      const vencimiento = new Date(c.vencimiento);
      return vencimiento >= now && vencimiento <= nextWeek;
    }
    return false;
  }).length;
  
  // Actualizar DOM con animación
  animateValue(elements.totalCausas, 0, total, 1000);
  animateValue(elements.causasFinalizadas, 0, finalizadas, 1200);
  animateValue(elements.causasVencimiento, 0, proximosVencimientos, 800);
  animateValue(elements.causasRecursos, 0, conRecursos, 1500);
  animateValue(elements.causasUsuario, 0, enTramite, 1300);
}

// Animación de números
function animateValue(element, start, end, duration) {
  if (!element) return;
  
  const range = end - start;
  const startTime = performance.now();
  
  function updateValue(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    
    const current = Math.floor(start + (range * easeOutQuart(progress)));
    element.textContent = current;
    
    if (progress < 1) {
      requestAnimationFrame(updateValue);
    }
  }
  
  requestAnimationFrame(updateValue);
}

function easeOutQuart(t) {
  return 1 - (--t) * t * t * t;
}

// Configurar gráficos
function setupCharts() {
  setupCausasChart();
  setupTiposChart();
}

function setupCausasChart() {
  const ctx = document.getElementById('causasChart');
  if (!ctx) return;
  
  chartInstances.causasChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
      datasets: [{
        label: 'Causas Ingresadas',
        data: [12, 19, 8, 15, 22, 18, 25, 20, 16, 23, 19, 14],
        borderColor: 'rgb(99, 102, 241)',
        backgroundColor: 'rgba(99, 102, 241, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4
      }, {
        label: 'Causas Finalizadas',
        data: [8, 15, 12, 10, 18, 15, 20, 17, 14, 19, 16, 12],
        borderColor: 'rgb(16, 185, 129)',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: {
            color: 'rgba(0,0,0,0.05)'
          }
        },
        x: {
          grid: {
            color: 'rgba(0,0,0,0.05)'
          }
        }
      },
      animation: {
        duration: 2000,
        easing: 'easeInOutQuart'
      }
    }
  });
}

function setupTiposChart() {
  const ctx = document.getElementById('tiposChart');
  if (!ctx) return;
  
  chartInstances.tiposChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Civil', 'Familia', 'Penal', 'Laboral', 'Violencia Familiar', 'Paz'],
      datasets: [{
        data: [30, 25, 15, 12, 18, 8],
        backgroundColor: [
          'rgba(99, 102, 241, 0.8)',
          'rgba(139, 92, 246, 0.8)',
          'rgba(245, 158, 11, 0.8)',
          'rgba(16, 185, 129, 0.8)',
          'rgba(239, 68, 68, 0.8)',
          'rgba(107, 114, 128, 0.8)'
        ],
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'bottom',
          labels: {
            padding: 20,
            usePointStyle: true
          }
        }
      },
      animation: {
        duration: 2000,
        easing: 'easeInOutQuart'
      }
    }
  });
}

function updateCharts() {
  if (!causasData.length) return;
  
  // Actualizar gráfico de tipos
  const tiposCounts = {};
  causasData.forEach(causa => {
    tiposCounts[causa.tipoProceso] = (tiposCounts[causa.tipoProceso] || 0) + 1;
  });
  
  if (chartInstances.tiposChart) {
    chartInstances.tiposChart.data.labels = Object.keys(tiposCounts);
    chartInstances.tiposChart.data.datasets[0].data = Object.values(tiposCounts);
    chartInstances.tiposChart.update();
  }
}

// Mostrar causas en tabla
function displayCausas() {
  if (!causasData.length) {
    elements.tablaCausas.innerHTML = '<div class="message message-info">No hay causas registradas</div>';
    return;
  }
  
  const table = document.createElement('table');
  table.className = 'modern-table';
  table.innerHTML = `
    <thead>
      <tr>
        <th>N° Expediente</th>
        <th>Carátula</th>
        <th>Tipo</th>
        <th>Juzgado</th>
        <th>Estado</th>
        <th>Prioridad</th>
        <th>Vencimiento</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      ${causasData.map(causa => `
        <tr>
          <td><strong>${causa.numCausa || 'N/A'}</strong></td>
          <td>${(causa.caratula || 'Sin carátula').substring(0, 50)}${(causa.caratula || '').length > 50 ? '...' : ''}</td>
          <td><span class="badge">${causa.tipoProceso || 'N/A'}</span></td>
          <td>${causa.juzgado || 'N/A'}</td>
          <td><span class="badge ${getEstadoClass(causa.estado)}">${causa.estado || 'N/A'}</span></td>
          <td><span class="priority-${(causa.prioridad || 'ninguna').toLowerCase()}">${causa.prioridad || 'Ninguna'}</span></td>
          <td>${causa.vencimiento ? formatDate(causa.vencimiento) : 'Sin vencimiento'}</td>
          <td>
            <button class="btn btn-primary btn-sm" onclick="editCausa('${causa.id}')">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-warning btn-sm" onclick="deleteCausa('${causa.id}')">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('')}
    </tbody>
  `;
  
  elements.tablaCausas.innerHTML = '';
  elements.tablaCausas.appendChild(table);
}

// Funciones auxiliares para la tabla
function getEstadoClass(estado) {
  switch(estado) {
    case 'Finalizado': return 'success';
    case 'En trámite': return 'primary';
    case 'Archivado': return 'secondary';
    case 'En Alzada': return 'warning';
    default: return 'secondary';
  }
}

function formatDate(dateString) {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleDateString('es-AR');
}

// Editar causa
window.editCausa = function(causaId) {
  const causa = causasData.find(c => c.id === causaId);
  if (!causa) return;
  
  editingCausa = causa;
  elements.tituloForm.innerHTML = '<i class="fas fa-edit"></i> Editar Expediente';
  
  // Llenar formulario
  Object.keys(causa).forEach(key => {
    const element = document.getElementById(key);
    if (element) {
      element.value = causa[key] || '';
    }
  });
  
  updateJuzgados();
  elements.formSection.classList.remove('hidden');
  elements.tablaCausas.classList.add('hidden');
  elements.estadisticasDetalladas.classList.add('hidden');
}

// Eliminar causa
window.deleteCausa = async function(causaId) {
  if (!confirm('¿Está seguro de eliminar esta causa?')) return;
  
  try {
    await db.collection('causas').doc(causaId).delete();
    showMessage('Causa eliminada exitosamente', 'success');
    loadCausas();
  } catch (error) {
    showMessage('Error al eliminar causa', 'error');
  }
}

// Guardar causa
async function handleGuardar() {
  if (!validateForm()) return;
  
  const formData = new FormData(elements.formCausa);
  const causaData = Object.fromEntries(formData.entries());
  
  // Agregar metadatos
  causaData.usuarioCreador = currentUser?.uid || 'demo';
  causaData.fechaModificacion = firebase.firestore ? firebase.firestore.FieldValue.serverTimestamp() : new Date().toISOString();
  
  try {
    showLoading(elements.btnGuardar);
    
    if (editingCausa) {
      if (db) {
        await db.collection('causas').doc(editingCausa.id).update(causaData);
      } else {
        // Modo demo
        const index = causasData.findIndex(c => c.id === editingCausa.id);
        if (index !== -1) {
          causasData[index] = { ...causasData[index], ...causaData };
        }
      }
      showMessage('Causa actualizada exitosamente', 'success');
    } else {
      causaData.fechaCreacion = firebase.firestore ? firebase.firestore.FieldValue.serverTimestamp() : new Date().toISOString();
      if (db) {
        await db.collection('causas').add(causaData);
      } else {
        // Modo demo
        causaData.id = 'demo-' + Date.now();
        causasData.unshift(causaData);
      }
      showMessage('Causa creada exitosamente', 'success');
    }
    
    elements.formCausa.reset();
    editingCausa = null;
    updateStatistics();
    updateEstadisticasDetalladas();
    elements.formSection.classList.add('hidden');
    
  } catch (error) {
    showMessage('Error al guardar causa: ' + error.message, 'error');
  } finally {
    hideLoading(elements.btnGuardar, 'Guardar');
  }
}

// Validar formulario
function validateForm() {
  const required = ['numCausa', 'caratula', 'tipoProceso', 'juzgado'];
  const missing = required.filter(field => !elements[field].value.trim());
  
  if (missing.length) {
    showMessage('Por favor complete los campos obligatorios', 'error');
    elements[missing[0]].focus();
    return false;
  }
  
  return true;
}

function setupFormValidation() {
  // Contador de caracteres
  updateCharCounter();
  
  // Selecciones múltiples
  setupMultiselect();
}

function updateCharCounter() {
  const text = elements.observaciones?.value || '';
  const count = text.length;
  const maxCount = 1000;
  
  if (elements.counter) {
    elements.counter.textContent = `${count}/${maxCount}`;
    elements.counter.style.color = count > maxCount ? 'var(--danger)' : 'var(--text-muted)';
  }
}

function setupMultiselect() {
  // Manejar selecciones múltiples
  const multiselectElements = ['proteccionPersona', 'organismos'];
  
  multiselectElements.forEach(id => {
    const select = document.getElementById(id);
    const display = document.getElementById(id + '-selected');
    
    if (select && display) {
      select.addEventListener('change', function() {
        const selected = Array.from(this.selectedOptions).map(option => option.text);
        display.textContent = selected.length ? 
          `Seleccionados: ${selected.join(', ')}` : 
          'Ninguno seleccionado';
      });
    }
  });
}

// Actualizar juzgados según tipo de proceso
function updateJuzgados() {
  const tipo = elements.tipoProceso?.value;
  const juzgados = juzgadosPorTipo[tipo] || [];
  
  if (elements.juzgado) {
    elements.juzgado.innerHTML = juzgados
      .map(j => `<option value="${j}">${j}</option>`)
      .join('');
  }
}

// Cargar usuarios en select
async function loadUsuariosSelect() {
  try {
    if (db) {
      const snapshot = await db.collection('usuarios').get();
      const usuarios = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      
      elements.usuarioAsignado.innerHTML = '<option value="">Sin asignar</option>' +
        usuarios.map(u => `<option value="${u.id}">${u.nombre} ${u.apellido}</option>`).join('');
    } else {
      // Modo demo
      elements.usuarioAsignado.innerHTML = `
        <option value="">Sin asignar</option>
        <option value="user1">Juan Pérez</option>
        <option value="user2">María González</option>
        <option value="user3">Carlos Rodríguez</option>
      `;
    }
  } catch (error) {
    console.error('Error al cargar usuarios:', error);
  }
}

// Actualizar información del usuario
function updateUserInfo() {
  if (currentUser) {
    elements.userDetails.textContent = `${currentUser.nombre} ${currentUser.apellido} - ${currentUser.rol}`;
  }
}

// Búsqueda
function handleSearch() {
  const query = elements.buscadorInput.value.toLowerCase().trim();
  
  if (!query) {
    displayCausas();
    return;
  }
  
  const filtered = causasData.filter(causa => {
    return (causa.numCausa || '').toLowerCase().includes(query) ||
           (causa.caratula || '').toLowerCase().includes(query) ||
           (causa.tipoProceso || '').toLowerCase().includes(query) ||
           (causa.juzgado || '').toLowerCase().includes(query);
  });
  
  displayFilteredCausas(filtered);
}

function displayFilteredCausas(filteredData) {
  if (!filteredData.length) {
    elements.tablaCausas.innerHTML = '<div class="message message-info">No se encontraron resultados</div>';
    return;
  }
  
  // Similar a displayCausas pero con datos filtrados
  const table = document.createElement('table');
  table.className = 'modern-table';
  table.innerHTML = `
    <thead>
      <tr>
        <th>N° Expediente</th>
        <th>Carátula</th>
        <th>Tipo</th>
        <th>Juzgado</th>
        <th>Estado</th>
        <th>Prioridad</th>
        <th>Vencimiento</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      ${filteredData.map(causa => `
        <tr>
          <td><strong>${causa.numCausa || 'N/A'}</strong></td>
          <td>${(causa.caratula || 'Sin carátula').substring(0, 50)}${(causa.caratula || '').length > 50 ? '...' : ''}</td>
          <td><span class="badge">${causa.tipoProceso || 'N/A'}</span></td>
          <td>${causa.juzgado || 'N/A'}</td>
          <td><span class="badge ${getEstadoClass(causa.estado)}">${causa.estado || 'N/A'}</span></td>
          <td><span class="priority-${(causa.prioridad || 'ninguna').toLowerCase()}">${causa.prioridad || 'Ninguna'}</span></td>
          <td>${causa.vencimiento ? formatDate(causa.vencimiento) : 'Sin vencimiento'}</td>
          <td>
            <button class="btn btn-primary btn-sm" onclick="editCausa('${causa.id}')">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-warning btn-sm" onclick="deleteCausa('${causa.id}')">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('')}
    </tbody>
  `;
  
  elements.tablaCausas.innerHTML = '';
  elements.tablaCausas.appendChild(table);
}

// Imprimir
function handleImprimir() {
  window.print();
}

// Cancelar formulario
function handleCancelar() {
  elements.formCausa.reset();
  editingCausa = null;
  elements.formSection.classList.add('hidden');
}

// Chatbot
function toggleChatbot() {
  const isVisible = !elements.chatbotContainer.classList.contains('hidden');
  
  if (isVisible) {
    elements.chatbotContainer.style.display = 'none';
    elements.chatbotContainer.classList.add('hidden');
  } else {
    elements.chatbotContainer.style.display = 'flex';
    elements.chatbotContainer.classList.remove('hidden');
  }
}

function sendChatMessage() {
  const message = elements.chatInput.value.trim();
  if (!message) return;
  
  addChatMessage(message, 'user');
  elements.chatInput.value = '';
  
  // Simular respuesta del bot
  setTimeout(() => {
    const response = generateBotResponse(message);
    addChatMessage(response, 'bot');
  }, 1000);
}

function addChatMessage(message, sender) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message-bubble ${sender}-message`;
  messageDiv.textContent = message;
  
  elements.chatBody.appendChild(messageDiv);
  elements.chatBody.scrollTop = elements.chatBody.scrollHeight;
}

function generateBotResponse(message) {
  const responses = [
    "Basándome en los datos actuales, puedo ayudarte con estadísticas de causas.",
    `Tienes ${causasData.length} causas registradas en el sistema.`,
    "¿Te gustaría saber sobre algún tipo específico de causa?",
    "Puedo ayudarte con información sobre vencimientos próximos.",
    "El sistema está funcionando correctamente. ¿En qué más puedo asistirte?"
  ];
  
  return responses[Math.floor(Math.random() * responses.length)];
}

// Utilidades
function showMessage(message, type = 'info') {
  elements.mensaje.textContent = message;
  elements.mensaje.className = `message message-${type}`;
  elements.mensaje.style.display = 'block';
  
  setTimeout(() => {
    elements.mensaje.style.display = 'none';
  }, 5000);
}

function showLoading(button) {
  const originalText = button.textContent;
  button.innerHTML = '<i class="loading-spinner"></i> Cargando...';
  button.disabled = true;
  button.dataset.originalText = originalText;
}

function hideLoading(button, defaultText) {
  button.innerHTML = `<i class="fas fa-check"></i> ${defaultText}`;
  button.disabled = false;
  
  setTimeout(() => {
    const icon = button.querySelector('i');
    if (icon) icon.className = icon.className.replace('fa-check', 'fa-save');
  }, 1000);
}
</script>

</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDseoffjiZ91j%2BhYBexxFyO5G%2F8VAGg5s2EfyHC7oca%2FXv95F5S6jo0NsMIi1oagHjlhLVwMP4KlXW1fOGqmrPp9tug7h2CQIQXTSJSPhvA5t2tJh7jJ8QuMG9CD%2F%2FJsiTKYH6HOG30NlAHBhR%2BFrTuqDn3lwgWBh%2F%2BmtybVmAQ4cP%2BIOeV4%2Bl2%2B6kl%2FjCbWViEtsf6Jm8FrJqDTA4zbX7etVEiJiFESQgeFu7x3eoSwyvFa%2BdnBOWUfDbDGJzQA%2BDXv1gW%2FNz%2Fu%2ByBEEEzB8epXZ3Oaaw9Ro%2BM4ps1PYLblenrt8E8Jc8BNWczjHOM8H3Hanyr2iieCFij%2FZwaeTSNY%2FLorCbSYIbtuO9WjXT6AOVSNlQ5O4Lo1olavU5O1UkF6D4aLAko9J8UOALkd49%2F3lsNRWTp0Js5DSqEWbvzOPMK9Zty%2FPdagUiT12%2FJgB9MpZRnwejyEHPnhNeoZvaopp8ldgZOJph8cmfqKVaxaI7ZED8MLju940ReY4guU1gQ%3D%3D";
        window.__genspark_locale = "es-ES";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDseoffjiZ91j+hYBexxFyO5G/8VAGg5s2EfyHC7oca/Xv95F5S6jo0NsMIi1oagHjlhLVwMP4KlXW1fOGqmrPp9tug7h2CQIQXTSJSPhvA5t2tJh7jJ8QuMG9CD//JsiTKYH6HOG30NlAHBhR+FrTuqDn3lwgWBh/+mtybVmAQ4cP+IOeV4+l2+6kl/jCbWViEtsf6Jm8FrJqDTA4zbX7etVEiJiFESQgeFu7x3eoSwyvFa+dnBOWUfDbDGJzQA+DXv1gW/Nz/u+yBEEEzB8epXZ3Oaaw9Ro+M4ps1PYLblenrt8E8Jc8BNWczjHOM8H3Hanyr2iieCFij/ZwaeTSNY/LorCbSYIbtuO9WjXT6AOVSNlQ5O4Lo1olavU5O1UkF6D4aLAko9J8UOALkd49/3lsNRWTp0Js5DSqEWbvzOPMK9Zty/PdagUiT12/JgB9MpZRnwejyEHPnhNeoZvaopp8ldgZOJph8cmfqKVaxaI7ZED8MLju940ReY4guU1gQ==";
    </script>
    
        <script id="html_badge_script2" src="https://www.genspark.ai/html_badge.js"></script>
        
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
